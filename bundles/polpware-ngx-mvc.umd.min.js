!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@polpware/fe-mvc"),require("@polpware/fe-data"),require("@polpware/fe-dependencies"),require("@polpware/fe-utilities"),require("@angular/core")):"function"==typeof define&&define.amd?define("@polpware/ngx-mvc",["exports","@polpware/fe-mvc","@polpware/fe-data","@polpware/fe-dependencies","@polpware/fe-utilities","@angular/core"],t):t(((e=e||self).polpware=e.polpware||{},e.polpware["ngx-mvc"]={}),e.feMvc,e.feData,e.feDependencies,e.feUtilities,e.ng.core)}(this,(function(e,t,o,r,n,i){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};function s(e,t){function o(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}var c=function(){return(c=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var n in t=arguments[o])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function p(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var r,n,i=o.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}return a}function d(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}
/**
     * @fileOverview
     * This abstract class defines a base class for implementing
     * a page with such features as refreshing, loading more, and
     * listening to changes from a global database and inserting
     * or deleting elements accordingly.
     *
     * This class does not depend on any features that a specific
     * platform may provide, such as ionViewDidload and ...unload.
     *
     * @name PlatformAgosticFullFeatureListPage.ts
     * @author Xiaolong Tang <xxlongtang@gmail.com>
     * @license Copyright @me
     */
r.underscore;var u=function(){function e(){this.moreDataCanBeLoaded=!1,this.callbacks={onRefresh:null,onInfinite:null}}return e.prototype.turnOnMediator=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var r=this.buildViewInstance();this.listMediator.startService(r,e)},e.prototype.turnOffMediator=function(){this.listMediator.stopService()},e}(),f=r.underscore,l=f.noop;function h(e){return{$data:{init:function(){e.$scope.moreDataCanBeLoaded=!1},setRefreshCallback:function(t){e.$scope.callbacks.onRefresh=t},setInfiniteCallback:function(t){e.$scope.callbacks.onInfinite=t},clean:function(){e.$scope.onItemsReady()},asyncPush:function(t){e.$scope.onNewItemsReady(t),e.$scope.onItemsReady()},syncPush:function(t){e.$scope.onNewItemsReady(t),e.$scope.onItemsReady()},asyncPop:function(t){e.$scope.onItemsReady()},syncPop:function(t){e.$scope.onItemsReady()},asyncPrepend:function(t){e.$scope.onNewItemsReady(t),e.$scope.onItemsReady()},syncPrepend:function(t){e.$scope.onNewItemsReady(t),e.$scope.onItemsReady()},asyncRefresh:l,syncRefresh:l,hasMoreData:function(t){e.$scope.moreDataCanBeLoaded=t},getItems:function(){},setupSearch:function(t,o){e.$scope.searchCriteria=t,e.$scope.doSearch=o},updateSearchCriteria:function(t){e.$scope.searchCriteria=t},getAncestor:function(){return e.$scope.ancestor}},$loader:{show:function(){e.$scope.showLoadingIndicator()},hide:function(){e.$scope.hideLoadingIndicator()}},$refresher:{show:function(){e.$scope.showRefreshingIndicator()},hide:function(){e.$scope.hideRefreshingIndicator()}},$moreLoader:{show:function(){e.$scope.showMoreLoading()},hide:function(){e.$scope.hideMoreLoading()}},$router:{go:function(t,o){e.$state.go(t,o)}},$render:{ready:function(t){e.$scope.callbacks.onViewDidLoad=t},destroy:function(t){e.$scope.callbacks.onViewWillUnload=t},asyncDigest:l},$navBar:{getState:l,setState:l},$modal:{setData:function(t,o){e.$scope[t]=o},getData:function(t){return e.$scope[t]},build:l},$popover:{setData:function(t,o){e.$scope[t]=o},getData:function(t){return e.$scope[t]},build:l,onHidden:l},$popup:{setData:function(t){e.$scope.popupInput=f.extend({confirmed:!1},t)},getData:function(){return e.$scope.popupInput},build:l,confirm:l,prompt:l,alert:l},$progressBar:{create:l,reset:function(){e.$scope.progressBar=0},createInfinite:l,onProgress:function(t){e.$scope.progressBar=t},destroy:l,destroyInfinite:l,showAbort:l},$alertify:e.alertify,$history:{goBack:function(){e.$ionicHistory.goBack()}}}}var y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.onDocumentReady=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.ensureDataProvider.apply(this,d(e))},t.prototype.onDocumentDestroy=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.turnOffMediator(),this.afterMediatorOff()},t.prototype.onDataProviderReady=function(e){var t=this;this.buildMediator(e).then((function(){t.turnOnMediator(!1),t.afterMediatorOn()}))},t.prototype.buildViewInstance=function(){return h({$scope:this})},t.prototype.doRefresh=function(){this.callbacks.onRefresh&&this.callbacks.onRefresh()},t.prototype.doInfinite=function(){this.callbacks.onInfinite&&this.callbacks.onInfinite()},t.prototype.showLoadingIndicator=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.hideLoadingIndicator=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.setLoadingIndicatorDelay=function(e){},t.prototype.showMoreLoading=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.hideMoreLoading=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.showRefreshingIndicator=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.hideRefreshingIndicator=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t}(u),g=function(e){function r(){var t=e.call(this)||this;return t.defaultLivePeriod=300,t.mediatorCtorOptions={useModel:!0,enableInfinite:!0,enableRefresh:!0},t.items=[],t._onCacheExpireCallback=null,t}return s(r,e),r.prototype.turnOnMediator=function(t){var o=this;e.prototype.turnOnMediator.call(this,t);var r=this.asNgStoreListMeidator.getNgStore();this._storeSubscription=r.getState().subscribe((function(e){var t=e.items;o.items=t,o.onItemsReady()}))},r.prototype.turnOffMediator=function(){this._storeSubscription.unsubscribe(),e.prototype.turnOffMediator.call(this)},r.prototype.buildMediator=function(e){var r=c(c({},this.mediatorCtorOptions),{dataProvider:e}),n=new o.CollectionStore,i=new t.NgStoreListMediator(r);return i.setNgStore(n),this.listMediator=i,this.listMediator.setUp(),Promise.resolve()},Object.defineProperty(r.prototype,"asNgStoreListMeidator",{get:function(){return this.listMediator},enumerable:!0,configurable:!0}),r.prototype.readMediatorFromCache=function(e){return this.mediatorCache.get(e,this.defaultLivePeriod)},r.prototype.writeMediatorIntoCache=function(e,t){this.mediatorCache.set(e,t,this.defaultLivePeriod,(function(e){return t.tearDown(),e}))},r.prototype.addOnCacheExpireHandler=function(e){this._onCacheExpireCallback=function(e){return e.preventDefault(),e},this.mediatorCache.addOnExpireHandler(e,this._onCacheExpireCallback)},r.prototype.removeOnCacheExpireHandler=function(e){this.mediatorCache.rmOnExpireHandler(e,this._onCacheExpireCallback),this._onCacheExpireCallback=null},r.prototype.onNewItemsReady=function(e){return e},r}(y),v=function(e){function o(){var t=e.call(this)||this;return t.defaultLivePeriod=300,t.items=[],t._onCacheExpireCallback=null,t}return s(o,e),Object.defineProperty(o.prototype,"asWritableListMediator",{get:function(){return this.listMediator},enumerable:!0,configurable:!0}),o.prototype.useMediatorWithOnlyLocalDataProvider=function(e,o){var r={dataProvider:e,useModel:!0,enableInfinite:!0,enableRefresh:!0},n=new t.WritableListMediator(r);this.listMediator=n,this.listMediator.setUp()},o.prototype.useMediatorWithGlobalDataProvider=function(e,o,r,n){var i=new t.RxjsPoweredWritableListMediator({globalProvider:o,filterFlags:{added:!0,removed:!0,updated:!1},dataProvider:e,useModel:!0});this.listMediator=i,this.listMediator.setUp()},o.prototype.postUseFreshMediator=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.turnOnMediator.apply(this,d([!1],e)),this.afterMediatorOn()},o.prototype.postUseCachedMediator=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.turnOnMediator.apply(this,d([!0],e)),this.afterMediatorOn()},o.prototype.ensureDataProvider=function(){for(var e=this,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];if(this.mediatorCache){var r=this.getCacheKey.apply(this,d(t)),n=this.readMediatorFromCache(r);n?(!0,this.listMediator=n,this.postUseCachedMediator.apply(this,d(t))):this.buildMediator.apply(this,d(t)).then((function(){e.writeMediatorIntoCache(r,e.asWritableListMediator),e.postUseFreshMediator.apply(e,d([!0],t))}))}else this.buildMediator.apply(this,d(t)).then((function(){e.postUseFreshMediator.apply(e,d([!1],t))}))},o.prototype.afterMediatorOn=function(){if(this.mediatorCache){var e=this.getCacheKey();this.addOnCacheExpireHandler(e)}},o.prototype.afterMediatorOff=function(){if(this.mediatorCache){var e=this.getCacheKey();this.removeOnCacheExpireHandler(e)}},o.prototype.onNewItemsReady=function(e){return n.pushArray(this.items,e),e},o.prototype.onItemsReady=function(){var e=this.asWritableListMediator.viewLevelData();this.items=e.models.slice(0)},o.prototype.readMediatorFromCache=function(e){return this.mediatorCache.get(e,this.defaultLivePeriod)},o.prototype.writeMediatorIntoCache=function(e,t){this.mediatorCache.set(e,t,this.defaultLivePeriod,(function(e){return t.tearDown(),e}))},o.prototype.addOnCacheExpireHandler=function(e){this._onCacheExpireCallback=function(e){return e.preventDefault(),e},this.mediatorCache.addOnExpireHandler(e,this._onCacheExpireCallback)},o.prototype.removeOnCacheExpireHandler=function(e){this.mediatorCache.rmOnExpireHandler(e,this._onCacheExpireCallback),this._onCacheExpireCallback=null},o}(y),m=function(){},b=new i.InjectionToken("Backend Settings");e.BACKEND_SETTINGS=b,e.BackboneBackedListPage=v,e.BackendSettings=m,e.FullFeatureListPage=y,e.NgStoreBackedListPage=g,e.PlatformObliviousListPage=u,e.adaptAngularToController=h,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=polpware-ngx-mvc.umd.min.js.map