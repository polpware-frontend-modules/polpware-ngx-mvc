!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@polpware/fe-mvc"),require("@polpware/fe-data"),require("@polpware/fe-dependencies"),require("@polpware/fe-utilities"),require("@angular/core"),require("@angular/forms")):"function"==typeof define&&define.amd?define("@polpware/ngx-mvc",["exports","@polpware/fe-mvc","@polpware/fe-data","@polpware/fe-dependencies","@polpware/fe-utilities","@angular/core","@angular/forms"],t):t(((e=e||self).polpware=e.polpware||{},e.polpware["ngx-mvc"]={}),e.feMvc,e.feData,e.feDependencies,e.feUtilities,e.ng.core,e.ng.forms)}(this,(function(e,t,o,i,r,n,a){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};function c(e,t){function o(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}var h=function(){return(h=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function p(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var i,r,n=o.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(r)throw r.error}}return a}function d(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}
/**
     * @fileOverview
     * This abstract class defines a base class for implementing
     * a page with such features as refreshing, loading more, and
     * listening to changes from a global database and inserting
     * or deleting elements accordingly.
     *
     * This class does not depend on any features that a specific
     * platform may provide, such as ionViewDidload and ...unload.
     *
     * @name PlatformAgosticFullFeatureListPage.ts
     * @author Xiaolong Tang <xxlongtang@gmail.com>
     * @license Copyright @me
     */
i.underscore;var u=function(){function e(){this.moreDataCanBeLoaded=!1,this.callbacks={onRefresh:null,onInfinite:null}}return e.prototype.turnOnMediator=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var i=this.buildViewInstance();this.listMediator.startService(i,e)},e.prototype.turnOffMediator=function(){this.listMediator.stopService()},e}(),f=i.underscore,l=f.noop;function y(e){return{$data:{init:function(){e.$scope.moreDataCanBeLoaded=!1},setRefreshCallback:function(t){e.$scope.callbacks.onRefresh=t},setInfiniteCallback:function(t){e.$scope.callbacks.onInfinite=t},clean:function(){e.$scope.onItemsReady()},asyncPush:function(t){e.$scope.onNewItemsReady(t),e.$scope.onItemsReady()},syncPush:function(t){e.$scope.onNewItemsReady(t),e.$scope.onItemsReady()},asyncPop:function(t){e.$scope.onItemsReady()},syncPop:function(t){e.$scope.onItemsReady()},asyncPrepend:function(t){e.$scope.onNewItemsReady(t),e.$scope.onItemsReady()},syncPrepend:function(t){e.$scope.onNewItemsReady(t),e.$scope.onItemsReady()},asyncRefresh:l,syncRefresh:l,hasMoreData:function(t){e.$scope.moreDataCanBeLoaded=t},getItems:function(){},setupSearch:function(t,o){e.$scope.searchCriteria=t,e.$scope.doSearch=o},updateSearchCriteria:function(t){e.$scope.searchCriteria=t},getAncestor:function(){return e.$scope.ancestor}},$loader:{show:function(){e.$scope.showLoadingIndicator()},hide:function(){e.$scope.hideLoadingIndicator()}},$refresher:{show:function(){e.$scope.showRefreshingIndicator()},hide:function(){e.$scope.hideRefreshingIndicator()}},$moreLoader:{show:function(){e.$scope.showMoreLoading()},hide:function(){e.$scope.hideMoreLoading()}},$router:{go:function(t,o){e.$state.go(t,o)}},$render:{ready:function(t){e.$scope.callbacks.onViewDidLoad=t},destroy:function(t){e.$scope.callbacks.onViewWillUnload=t},asyncDigest:l},$navBar:{getState:l,setState:l},$modal:{setData:function(t,o){e.$scope[t]=o},getData:function(t){return e.$scope[t]},build:l},$popover:{setData:function(t,o){e.$scope[t]=o},getData:function(t){return e.$scope[t]},build:l,onHidden:l},$popup:{setData:function(t){e.$scope.popupInput=f.extend({confirmed:!1},t)},getData:function(){return e.$scope.popupInput},build:l,confirm:l,prompt:l,alert:l},$progressBar:{create:l,reset:function(){e.$scope.progressBar=0},createInfinite:l,onProgress:function(t){e.$scope.progressBar=t},destroy:l,destroyInfinite:l,showAbort:l},$alertify:e.alertify,$history:{goBack:function(){e.$ionicHistory.goBack()}}}}var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t.prototype.onDocumentReady=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.ensureDataProvider.apply(this,d(e))},t.prototype.onDocumentDestroy=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.turnOffMediator(),this.afterMediatorOff()},t.prototype.onDataProviderReady=function(e){var t=this;this.buildMediator(e).then((function(){t.turnOnMediator(!1),t.afterMediatorOn()}))},t.prototype.buildViewInstance=function(){return y({$scope:this})},t.prototype.doRefresh=function(){this.callbacks.onRefresh&&this.callbacks.onRefresh()},t.prototype.doInfinite=function(){this.callbacks.onInfinite&&this.callbacks.onInfinite()},t.prototype.showLoadingIndicator=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.hideLoadingIndicator=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.setLoadingIndicatorDelay=function(e){},t.prototype.showMoreLoading=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.hideMoreLoading=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.showRefreshingIndicator=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.hideRefreshingIndicator=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t}(u),m=function(e){function i(){var t=e.call(this)||this;return t.defaultLivePeriod=300,t.mediatorCtorOptions={useModel:!0,enableInfinite:!0,enableRefresh:!0},t.items=[],t._onCacheExpireCallback=null,t}return c(i,e),i.prototype.turnOnMediator=function(t){var o=this;e.prototype.turnOnMediator.call(this,t);var i=this.asNgStoreListMeidator.getNgStore();this._storeSubscription=i.getState().subscribe((function(e){var t=e.items;o.items=t,o.onItemsReady()}))},i.prototype.turnOffMediator=function(){this._storeSubscription.unsubscribe(),e.prototype.turnOffMediator.call(this)},i.prototype.buildMediator=function(e){var i=h(h({},this.mediatorCtorOptions),{dataProvider:e}),r=new o.CollectionStore,n=new t.NgStoreListMediator(i);return n.setNgStore(r),this.listMediator=n,this.listMediator.setUp(),Promise.resolve()},Object.defineProperty(i.prototype,"asNgStoreListMeidator",{get:function(){return this.listMediator},enumerable:!0,configurable:!0}),i.prototype.readMediatorFromCache=function(e){return this.mediatorCache.get(e,this.defaultLivePeriod)},i.prototype.writeMediatorIntoCache=function(e,t){this.mediatorCache.set(e,t,this.defaultLivePeriod,(function(e){return t.tearDown(),e}))},i.prototype.addOnCacheExpireHandler=function(e){this._onCacheExpireCallback=function(e){return e.preventDefault(),e},this.mediatorCache.addOnExpireHandler(e,this._onCacheExpireCallback)},i.prototype.removeOnCacheExpireHandler=function(e){this.mediatorCache.rmOnExpireHandler(e,this._onCacheExpireCallback),this._onCacheExpireCallback=null},i.prototype.onNewItemsReady=function(e){return e},i}(g),v=function(e){function o(){var t=e.call(this)||this;return t.defaultLivePeriod=300,t.items=[],t._onCacheExpireCallback=null,t}return c(o,e),Object.defineProperty(o.prototype,"asWritableListMediator",{get:function(){return this.listMediator},enumerable:!0,configurable:!0}),o.prototype.useMediatorWithOnlyLocalDataProvider=function(e,o){var i={dataProvider:e,useModel:!0,enableInfinite:!0,enableRefresh:!0},r=new t.WritableListMediator(i);this.listMediator=r,this.listMediator.setUp()},o.prototype.useMediatorWithGlobalDataProvider=function(e,o,i,r){var n=new t.RxjsPoweredWritableListMediator({globalProvider:o,filterFlags:{added:!0,removed:!0,updated:!1},dataProvider:e,useModel:!0});this.listMediator=n,this.listMediator.setUp()},o.prototype.postUseFreshMediator=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.turnOnMediator.apply(this,d([!1],e)),this.afterMediatorOn()},o.prototype.postUseCachedMediator=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.turnOnMediator.apply(this,d([!0],e)),this.afterMediatorOn()},o.prototype.ensureDataProvider=function(){for(var e=this,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];if(this.mediatorCache){var i=this.getCacheKey.apply(this,d(t)),r=this.readMediatorFromCache(i);r?(!0,this.listMediator=r,this.postUseCachedMediator.apply(this,d(t))):this.buildMediator.apply(this,d(t)).then((function(){e.writeMediatorIntoCache(i,e.asWritableListMediator),e.postUseFreshMediator.apply(e,d([!0],t))}))}else this.buildMediator.apply(this,d(t)).then((function(){e.postUseFreshMediator.apply(e,d([!1],t))}))},o.prototype.afterMediatorOn=function(){if(this.mediatorCache){var e=this.getCacheKey();this.addOnCacheExpireHandler(e)}},o.prototype.afterMediatorOff=function(){if(this.mediatorCache){var e=this.getCacheKey();this.removeOnCacheExpireHandler(e)}},o.prototype.onNewItemsReady=function(e){return r.pushArray(this.items,e),e},o.prototype.onItemsReady=function(){var e=this.asWritableListMediator.viewLevelData();this.items=e.models.slice(0)},o.prototype.readMediatorFromCache=function(e){return this.mediatorCache.get(e,this.defaultLivePeriod)},o.prototype.writeMediatorIntoCache=function(e,t){this.mediatorCache.set(e,t,this.defaultLivePeriod,(function(e){return t.tearDown(),e}))},o.prototype.addOnCacheExpireHandler=function(e){this._onCacheExpireCallback=function(e){return e.preventDefault(),e},this.mediatorCache.addOnExpireHandler(e,this._onCacheExpireCallback)},o.prototype.removeOnCacheExpireHandler=function(e){this.mediatorCache.rmOnExpireHandler(e,this._onCacheExpireCallback),this._onCacheExpireCallback=null},o}(g),b=function(){},w=new n.InjectionToken("Backend Settings"),C=t.RxjsPoweredWritableListMediator.extend({Properties:"filter,keyword,pageSize",init:function(e){this._super(e),this._filter="",this._keyword=e.keyword||"",this._pageSize=e.pageSize||40,this._fromCache=!1},renderData:function(e){this._super(e)},startService:function(e,t){this.attachView(e),!0===t?(this._fromCache=!0,this.renderData(!0)):(this._fromCache=!1,this.startServiceImpl())},reComputeDataParams:function(){var e=this._dataProvider.state;e.offset=0,e.keyword=this._keyword||""},loadInitData:function(){return this.reComputeDataParams(),this._super()}}),M=function(e){function t(t){var o=e.call(this)||this;return o._listSettings=t,o.mediatorCache=o.getGlobalCache(),o}return c(t,e),Object.defineProperty(t.prototype,"asDefListBaseMediator",{get:function(){return this.listMediator},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fromCache",{get:function(){return!!this.listMediator&&this.asDefListBaseMediator._formCache},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inInitState",{get:function(){return!this.listMediator||this.asDefListBaseMediator._isInit},enumerable:!0,configurable:!0}),t.prototype.getCacheKey=function(){return this._listSettings.cacheKey},t.prototype.buildMediator=function(e){var t,o=this.getBackendService().backendProvider;t=this.getRelationalDB().get().getTable(this._listSettings.tableName).dataProvider();var i=new(o.getEndPoint(this._listSettings.endpointName));this.touchLocalDataProvider(i),i.state.pageSize=40,i.state.keyword=e;var r={globalProvider:t,filterFlags:t?{added:!0,removed:!0,updated:!1}:{added:!1,removed:!1,updated:!1},dataProvider:i,useModel:!0,keyword:e,pageSize:40,enableInfinite:!0,enableRefresh:!0};return this.listMediator=this.invokeMediatorCtor(r),this.listMediator.setUp(),Promise.resolve()},t.prototype.invokeMediatorCtor=function(e){return new C(e)},t.prototype.touchLocalDataProvider=function(e){},t}(v),I=["searchControlElem"],S=function(e){function t(t,o,i){var r=e.call(this,t)||this;return r._spinner=o,r._toastr=i,r.bottomOffset=0,r.minHeight=0,r.fixedHeight=0,r.maxHeight=0,r.topOffset=0,r.containerClass="",r.initHighlightId="",r.onSelect=new n.EventEmitter,r.searchEnabled=!0,r.searchControl=new a.FormControl(""),r}return c(t,e),Object.defineProperty(t.prototype,"totalCount",{get:function(){return this.asDefListBaseMediator.dataProvider().state.totalRecords},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offset",{get:function(){return this.asDefListBaseMediator.dataProvider().state.totalRecords},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spinnerName",{get:function(){return this._listSettings.spinnerName},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this._spinner.startToListenSpinner(this.spinnerName),this.onDocumentReady(),this.startObserveSearchKeyword()},t.prototype.ngOnDestroy=function(){this._spinner.stopListener(this.spinnerName),this.onDocumentDestroy(),this.stopObserveSearchKeyword()},t.prototype.turnOnMediator=function(t,o){e.prototype.turnOnMediator.call(this,t,o)},t.prototype.showLoadingIndicator=function(){this._spinner.show("Loading ...",this.spinnerName)},t.prototype.hideLoadingIndicator=function(){this._spinner.hide(this.spinnerName)},t.prototype.showMoreLoading=function(){this._spinner.show("Loading ...",this.spinnerName)},t.prototype.hideMoreLoading=function(){this._spinner.hide(this.spinnerName)},t.prototype.showRefreshingIndicator=function(){this._spinner.show("Loading ...",this.spinnerName)},t.prototype.hideRefreshingIndicator=function(){this._spinner.hide(this.spinnerName),this._toastr.success("List was just refreshed.","Success",{closeButton:!0})},t.prototype.startObserveSearchKeyword=function(){var e=this;this._searchKeywordSubr=this.searchControl.valueChanges.subscribe((function(t){(t=(t||"").toLowerCase())&&t!==e.keywordInEffect?e.anyFutureKeyword=t:e.anyFutureKeyword=""}))},t.prototype.stopObserveSearchKeyword=function(){this._searchKeywordSubr&&this._searchKeywordSubr.unsubscribe()},t.prototype.computeSearchState=function(){this.anyFutureKeyword="",this.keywordInEffectState=!1,this.typeKeywordState=!1,this.waitForInputState=!1;var e=this.asDefListBaseMediator.keyword();e?(e=e.toLowerCase(),this.keywordInEffect=e,this.keywordInEffectState=!0,(this.searchControl.value||"").toLowerCase()!==e&&this.searchControl.setValue(e,{emitEvent:!1})):(this.waitForInputState=!0,(this.searchControl.value||"").toLowerCase()&&this.searchControl.setValue("",{emitEvent:!1}))},t.prototype.startToTypeKeyword=function(){this.anyFutureKeyword="",this.waitForInputState=!1,this.keywordInEffectState=!1,this.typeKeywordState=!0,setTimeout((function(){}))},t.prototype.cancelTypedKeyword=function(){this.computeSearchState(),this.searchControlElem.nativeElement.focus()},t.prototype.clearKeywordInEffect=function(){this.asDefListBaseMediator.keyword(""),this.asDefListBaseMediator.refresh(!0),this.searchControlElem.nativeElement.focus()},t.prototype.kickOffSearch=function(){var e=this.searchControl.value;e!==this.asDefListBaseMediator.keyword?(this.asDefListBaseMediator.keyword(e),this.asDefListBaseMediator.refresh(!0)):this.computeSearchState()},t.prototype.onItemsReady=function(){e.prototype.onItemsReady.call(this),this.computeSearchState(),this.initHighlightId&&this.highlight(this.initHighlightId)},t.prototype.selectItem=function(e){this.initHighlightId=null,this.selected=e,this.onSelect.emit(e)},t.prototype.highlight=function(e){var t=this.items.find((function(t){return t.id==e}));t&&this.selected!==t&&(this.selected=t)},t.ɵfac=function(e){n.ɵɵinvalidFactory()},t.ɵdir=n.ɵɵdefineDirective({type:t,viewQuery:function(e,t){var o;(1&e&&n.ɵɵviewQuery(I,!0),2&e)&&(n.ɵɵqueryRefresh(o=n.ɵɵloadQuery())&&(t.searchControlElem=o.first))},inputs:{bottomOffset:"bottomOffset",minHeight:"minHeight",fixedHeight:"fixedHeight",maxHeight:"maxHeight",topOffset:"topOffset",containerClass:"containerClass",initHighlightId:"initHighlightId"},outputs:{onSelect:"onSelect"},features:[n.ɵɵInheritDefinitionFeature]}),t}(M);e.BACKEND_SETTINGS=w,e.BackboneBackedListPage=v,e.BackendSettings=b,e.DefListBaseComponent=S,e.DefListBaseController=M,e.DefListBaseMediator=C,e.FullFeatureListPage=g,e.NgStoreBackedListPage=m,e.PlatformObliviousListPage=u,e.adaptAngularToController=y,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=polpware-ngx-mvc.umd.min.js.map